{"version":3,"file":"main.js","mappings":"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","sources":["webpack://chat/./src/js/api/createRequest.js","webpack://chat/./src/js/api/ChatAPI.js","webpack://chat/./src/js/ChatView.js","webpack://chat/./src/js/Chat.js","webpack://chat/./src/js/app.js","webpack://chat/./src/index.js"],"sourcesContent":["const createRequest = async (options = {}) => {\n  const response = await fetch(options.url, {\n    method: options.method,\n    body: JSON.stringify(options.data),\n  });\n\n  const json = await response.json();\n\n  return json;\n};\n\nexport default createRequest;\n","import createRequest from './createRequest';\n\nexport default class ChatAPI {\n  constructor() {\n    this.url = 'https://chat-backend-ff5v.onrender.com';\n  }\n\n  async createUser(userName) {\n    const url = `${this.url}/new-user`;\n    const options = {\n      url,\n      method: 'POST',\n      data: userName,\n    };\n    const result = await createRequest(options);\n    return result;\n  }\n}\n","export default class ChatView {\n  static drawChat() {\n    const chat = document.createElement('div');\n    chat.classList.add('chat');\n    chat.innerHTML = `\n      <div class=\"chat__container\">\n        <div class=\"chat__list\">\n          <ul class=\"chat__users\">\n          </ul>\n\n          <button class=\"chat__btn-exit\">Log out</button>\n        </div>\n        <div class=\"chat__block\">\n          <div class=\"chat__messages\"></div>\n          <div class=\"chat__field\">\n            <input name=\"\" class=\"chat__input\" placeholder=\"Type your message here\"/>\n            <button class=\"chat__btn-send\">\n              <span class=\"chat__btn-icon\">\n                <img src=\"./images/Send.svg\" alt=\"\">\n              </span>\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    return chat;\n  }\n}\n","import ChatAPI from './api/ChatAPI';\nimport ChatView from './ChatView';\n\nexport default class Chat {\n  constructor(container) {\n    this.container = container;\n    this.api = new ChatAPI();\n    this.websocket = null;\n\n    this.logIn = this.logIn.bind(this);\n    this.sendMessage = this.sendMessage.bind(this);\n    this.logout = this.logout.bind(this);\n  }\n\n  init() {\n    this.bindToDOM();\n    this.registerEvents();\n  }\n\n  bindToDOM() {\n    this.container.innerHTML = `\n      <div class=\"popover\">\n        <div class=\"popover__container\">\n          <form class=\"popover__form form\">\n            <h1 class=\"form__title\">Enter your nickname</h1>\n            <div class=\"form__field\">\n              <input type=\"text\" name=\"name\" class=\"form__input\" required>\n            </div>\n            <button class=\"form__btn-continue\">Continue</button>\n          </form>\n        </div>\n      </div>\n    `;\n\n    this.popover = this.container.querySelector('.popover');\n    this.form = this.container.querySelector('.form');\n    this.inputName = this.form.querySelector('.form__input');\n    this.btnAddUser = this.form.querySelector('.form__btn-continue');\n  }\n\n  // Добавяем обработчики событий для popover\n  registerEvents() {\n    this.form.addEventListener('submit', this.logIn);\n    this.btnAddUser.addEventListener('click', this.logIn);\n    this.inputName.addEventListener('input', () => {\n      if (this.error) this.error.remove();\n    });\n  }\n\n  // Закрываем popover, открываем чат и добавляем пользователя\n  async logIn(e) {\n    e.preventDefault();\n    const user = {\n      name: this.inputName.value,\n    };\n    const result = await this.api.createUser(user);\n\n    if (result.status === 'error') {\n      this.showError();\n      return;\n    }\n\n    this.popover.remove();\n    this.createChat();\n    this.user = result.user;\n    this.addUser(result.user);\n  }\n\n  // Создаем чат\n  createChat() {\n    this.chat = ChatView.drawChat();\n    this.container.append(this.chat);\n\n    this.users = this.chat.querySelector('.chat__users');\n    this.btnExit = this.chat.querySelector('.chat__btn-exit');\n    this.messages = this.chat.querySelector('.chat__messages');\n    this.btnSend = this.chat.querySelector('.chat__btn-send');\n    this.inputMessage = this.chat.querySelector('.chat__input');\n\n    this.addEventsForChat();\n\n    this.websocket = new WebSocket('wss://chat-backend-ff5v.onrender.com//ws');\n    this.subscribeOnEvents();\n  }\n\n  // Добавляем пользователя\n  addUser({ id, name }) {\n    const user = document.createElement('li');\n    user.classList.add('chat__user', 'user');\n    user.setAttribute('data-id', id);\n    const isYou = id === this.user.id;\n    user.innerHTML = `\n      <span class=\"user__name ${isYou ? 'user__name_red' : ''}\">${isYou ? 'You' : name}</span>\n    `;\n    this.users.append(user);\n  }\n\n  // Показываем ошибку\n  showError() {\n    this.error = document.createElement('p');\n    this.error.classList.add('form__error');\n    this.error.textContent = 'The nickname you provided already exists';\n    this.inputName.after(this.error);\n  }\n\n  // Подписываемя на события websocket\n  subscribeOnEvents() {\n    this.websocket.addEventListener('message', (e) => {\n      const data = JSON.parse(e.data);\n      if (data.type === 'send') {\n        this.renderMessage(data);\n        this.scrollChat();\n        return;\n      }\n\n      this.users.innerHTML = '';\n      data.forEach((user) => this.addUser(user));\n    });\n  }\n\n  // Добавяем обработчики событий для чата\n  addEventsForChat() {\n    this.inputMessage.addEventListener('keydown', (e) => {\n      if (e.key !== 'Enter') return;\n\n      this.sendMessage(e);\n    });\n\n    this.btnSend.addEventListener('click', this.sendMessage);\n    this.btnExit.addEventListener('click', this.logout);\n  }\n\n  // При клике отправить или 'enter' отправляем сообщение\n  sendMessage(e) {\n    e.preventDefault();\n    const message = this.inputMessage.value;\n\n    if (!message) return;\n\n    const data = {\n      type: 'send',\n      user: {\n        name: this.user.name,\n      },\n      message,\n    };\n\n    this.websocket.send(JSON.stringify(data));\n    this.inputMessage.value = '';\n  }\n\n  // Создаем разметку сообщения\n  renderMessage({ user, message }) {\n    const isUser = this.user.name === user.name;\n    const { time, date } = this.formatDate();\n    const messageHTML = `\n      <div class=\"chat__message message ${isUser ? 'message-user' : ''}\">\n        <div class=\"message__data\">\n          <div class=\"message__sender\">${isUser ? 'You' : user.name},</div>\n          <div class=\"message__date\">${time} ${date}</div>\n        </div>\n        <div class=\"message__content\">${message}</div>\n      </div>\n    `;\n    this.messages.insertAdjacentHTML('beforeend', messageHTML);\n  }\n\n  // Форматируем дату\n  formatDate() {\n    const options = { hour: 'numeric', minute: 'numeric' };\n    const fullDate = new Date();\n    const time = fullDate.toLocaleTimeString('ru-RU', options);\n    const date = fullDate.toLocaleDateString();\n\n    return { time, date };\n  }\n\n  // При клике выйти направляем сообщение серверу, выводим начальное окно и обновляем пользователей\n  logout(e) {\n    e.preventDefault();\n\n    const data = {\n      type: 'exit',\n      user: {\n        name: this.user.name,\n      },\n    };\n\n    this.websocket.send(JSON.stringify(data));\n\n    this.chat.remove();\n    window.location.reload();\n  }\n\n  // Автоматическое пролистывание чата вниз\n  scrollChat() {\n    this.messages.scrollBy({\n      top: this.messages.scrollHeight,\n      left: 0,\n      behavior: 'smooth',\n    });\n  }\n}\n","import Chat from './Chat';\n\nconst root = document.querySelector('.root');\n\nconst app = new Chat(root);\n\napp.init();\n","import './scss/chat.scss';\nimport './js/app';\n"],"names":["createRequest","options","arguments","length","undefined","response","fetch","url","method","body","JSON","stringify","data","json","ChatAPI","constructor","createUser","userName","result","ChatView","drawChat","chat","document","createElement","classList","add","innerHTML","Chat","container","api","websocket","logIn","bind","sendMessage","logout","init","bindToDOM","registerEvents","popover","querySelector","form","inputName","btnAddUser","addEventListener","error","remove","e","preventDefault","user","name","value","status","showError","createChat","addUser","append","users","btnExit","messages","btnSend","inputMessage","addEventsForChat","WebSocket","subscribeOnEvents","_ref","id","setAttribute","isYou","textContent","after","parse","type","renderMessage","scrollChat","forEach","key","message","send","_ref2","isUser","time","date","formatDate","messageHTML","insertAdjacentHTML","hour","minute","fullDate","Date","toLocaleTimeString","toLocaleDateString","window","location","reload","scrollBy","top","scrollHeight","left","behavior","root","app"],"sourceRoot":""}